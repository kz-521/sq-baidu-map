(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ca2fd336"],{"1c4c":function(t,n,e){"use strict";var i=e("9b43"),a=e("5ca1"),r=e("4bf8"),o=e("1fa8"),s=e("33a4"),c=e("9def"),l=e("f1ae"),u=e("27ee");a(a.S+a.F*!e("5cc5")((function(t){Array.from(t)})),"Array",{from:function(t){var n,e,a,h,f=r(t),d="function"==typeof this?this:Array,p=arguments.length,v=p>1?arguments[1]:void 0,m=void 0!==v,g=0,w=u(f);if(m&&(v=i(v,p>2?arguments[2]:void 0,2)),void 0==w||d==Array&&s(w))for(n=c(f.length),e=new d(n);n>g;g++)l(e,g,m?v(f[g],g):f[g]);else for(h=w.call(f),e=new d;!(a=h.next()).done;g++)l(e,g,m?o(h,v,[a.value,g],!0):a.value);return e.length=g,e}})},"2f21":function(t,n,e){"use strict";var i=e("79e5");t.exports=function(t,n){return!!t&&i((function(){n?t.call(null,(function(){}),1):t.call(null)}))}},"55dd":function(t,n,e){"use strict";var i=e("5ca1"),a=e("d8e8"),r=e("4bf8"),o=e("79e5"),s=[].sort,c=[1,2,3];i(i.P+i.F*(o((function(){c.sort(void 0)}))||!o((function(){c.sort(null)}))||!e("2f21")(s)),"Array",{sort:function(t){return void 0===t?s.call(r(this)):s.call(r(this),a(t))}})},"5df3":function(t,n,e){"use strict";var i=e("02f4")(!0);e("01f9")(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=i(n,e),this._i+=t.length,{value:t,done:!1})}))},"67ab":function(t,n,e){var i=e("ca5a")("meta"),a=e("d3f4"),r=e("69a8"),o=e("86cc").f,s=0,c=Object.isExtensible||function(){return!0},l=!e("79e5")((function(){return c(Object.preventExtensions({}))})),u=function(t){o(t,i,{value:{i:"O"+ ++s,w:{}}})},h=function(t,n){if(!a(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,i)){if(!c(t))return"F";if(!n)return"E";u(t)}return t[i].i},f=function(t,n){if(!r(t,i)){if(!c(t))return!0;if(!n)return!1;u(t)}return t[i].w},d=function(t){return l&&p.NEED&&c(t)&&!r(t,i)&&u(t),t},p=t.exports={KEY:i,NEED:!1,fastKey:h,getWeak:f,onFreeze:d}},"6dcf":function(t,n,e){"use strict";e("92fe")},"7f7f":function(t,n,e){var i=e("86cc").f,a=Function.prototype,r=/^\s*function ([^ (]*)/,o="name";o in a||e("9e1e")&&i(a,o,{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(t){return""}}})},"92fe":function(t,n,e){},b39a:function(t,n,e){var i=e("d3f4");t.exports=function(t,n){if(!i(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}},c121:function(t,n){t.exports="data:image/png;base64,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"},c26b:function(t,n,e){"use strict";var i=e("86cc").f,a=e("2aeb"),r=e("dcbc"),o=e("9b43"),s=e("f605"),c=e("4a59"),l=e("01f9"),u=e("d53b"),h=e("7a56"),f=e("9e1e"),d=e("67ab").fastKey,p=e("b39a"),v=f?"_s":"size",m=function(t,n){var e,i=d(n);if("F"!==i)return t._i[i];for(e=t._f;e;e=e.n)if(e.k==n)return e};t.exports={getConstructor:function(t,n,e,l){var u=t((function(t,i){s(t,u,n,"_i"),t._t=n,t._i=a(null),t._f=void 0,t._l=void 0,t[v]=0,void 0!=i&&c(i,e,t[l],t)}));return r(u.prototype,{clear:function(){for(var t=p(this,n),e=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete e[i.i];t._f=t._l=void 0,t[v]=0},delete:function(t){var e=p(this,n),i=m(e,t);if(i){var a=i.n,r=i.p;delete e._i[i.i],i.r=!0,r&&(r.n=a),a&&(a.p=r),e._f==i&&(e._f=a),e._l==i&&(e._l=r),e[v]--}return!!i},forEach:function(t){p(this,n);var e,i=o(t,arguments.length>1?arguments[1]:void 0,3);while(e=e?e.n:this._f){i(e.v,e.k,this);while(e&&e.r)e=e.p}},has:function(t){return!!m(p(this,n),t)}}),f&&i(u.prototype,"size",{get:function(){return p(this,n)[v]}}),u},def:function(t,n,e){var i,a,r=m(t,n);return r?r.v=e:(t._l=r={i:a=d(n,!0),k:n,v:e,p:i=t._l,n:void 0,r:!1},t._f||(t._f=r),i&&(i.n=r),t[v]++,"F"!==a&&(t._i[a]=r)),t},getEntry:m,setStrong:function(t,n,e){l(t,n,(function(t,e){this._t=p(t,n),this._k=e,this._l=void 0}),(function(){var t=this,n=t._k,e=t._l;while(e&&e.r)e=e.p;return t._t&&(t._l=e=e?e.n:t._t._f)?u(0,"keys"==n?e.k:"values"==n?e.v:[e.k,e.v]):(t._t=void 0,u(1))}),e?"entries":"values",!e,!0),h(n)}}},e0b8:function(t,n,e){"use strict";var i=e("7726"),a=e("5ca1"),r=e("2aba"),o=e("dcbc"),s=e("67ab"),c=e("4a59"),l=e("f605"),u=e("d3f4"),h=e("79e5"),f=e("5cc5"),d=e("7f20"),p=e("5dbc");t.exports=function(t,n,e,v,m,g){var w=i[t],A=w,y=m?"set":"add",C=A&&A.prototype,M={},L=function(t){var n=C[t];r(C,t,"delete"==t||"has"==t?function(t){return!(g&&!u(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!u(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,e){return n.call(this,0===t?0:t,e),this})};if("function"==typeof A&&(g||C.forEach&&!h((function(){(new A).entries().next()})))){var O=new A,E=O[y](g?{}:-0,1)!=O,b=h((function(){O.has(1)})),k=f((function(t){new A(t)})),R=!g&&h((function(){var t=new A,n=5;while(n--)t[y](n,n);return!t.has(-0)}));k||(A=n((function(n,e){l(n,A,t);var i=p(new w,n,A);return void 0!=e&&c(e,m,i[y],i),i})),A.prototype=C,C.constructor=A),(b||R)&&(L("delete"),L("has"),m&&L("get")),(R||E)&&L(y),g&&C.clear&&delete C.clear}else A=v.getConstructor(n,t,m,y),o(A.prototype,e),s.NEED=!0;return d(A,t),M[t]=A,a(a.G+a.W+a.F*(A!=w),M),g||v.setStrong(A,t,m),A}},e641:function(t,n,e){"use strict";e.r(n);var i=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("div",{staticClass:"mobile-container"},[i("div",{staticClass:"header"},[i("div",{staticClass:"search-header-content"},[i("div",{staticClass:"left-icon",on:{click:t.handleBack}},[i("img",{staticClass:"frame-icon",attrs:{src:e("336c"),alt:"返回"}})]),i("div",{staticClass:"search-adr"},[t._v("热力图")])])]),i("div",{staticClass:"map-container",attrs:{id:"heatmap-container"}}),t._m(0),i("div",{staticClass:"fixed-locate-button",on:{click:t.locateToCurrent}},[i("img",{staticClass:"loc-icon",attrs:{src:e("9b25"),alt:"定位"}})]),t.showLocationTip?i("div",{staticClass:"location-tip-bar"},[t._m(1),i("button",{staticClass:"tip-button",on:{click:t.enableLocation}},[t._v("开启")])]):t._e()])},a=[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"fixed-legend"},[e("div",{staticClass:"legend-label top"},[t._v("人多")]),e("div",{staticClass:"legend-bar"},[e("div",{staticClass:"legend-seg seg-1"}),e("div",{staticClass:"legend-seg seg-2"}),e("div",{staticClass:"legend-seg seg-3"})]),e("div",{staticClass:"legend-label bottom"},[t._v("人少")])])},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"tip-content"},[e("div",{staticClass:"tip-icon"},[t._v("!")]),e("div",{staticClass:"tip-text"},[t._v("未能获取到您的位置信息，去手动开启")])])}],r=(e("1c4c"),e("55dd"),e("7f7f"),e("5df3"),e("f400"),e("ac6a"),e("96cf"),e("1da1")),o=e("b123"),s=e("c121"),c=e.n(s),l={DEFAULT_CENTER:{lng:120.019,lat:30.274},DEFAULT_ZOOM:15,LOCATION_ZOOM:16,SEARCH_RADIUS:5e3,MAX_POI_COUNT:60},u={KEYWORDS:["商圈","购物中心","商业广场","商业街","国际广场","中心"],WEIGHTS:{"商圈":1.3,"购物中心":1.2,"商业广场":1.1,"商业街":1,"国际广场":.9,"中心":.9},COLORS:{PRIMARY:"255,69,58",SECONDARY:"255,122,124",TERTIARY:"255,179,180"}},h=[{featureType:"background",elementType:"geometry",stylers:{color:"#f5f5f5"}},{featureType:"water",elementType:"geometry",stylers:{color:"#e3f2fd"}},{featureType:"landscape",elementType:"geometry",stylers:{color:"#f5f5f5"}}],f={name:"HeatMap",data:function(){return{map:null,mapLoaded:!1,showLocationTip:!1,locationPermission:"prompt",locationPoint:null,heatOverlays:[],heatPOIs:[],currentMarker:null,lastLocation:null,userHeading:0,locationHistory:[],maxHistoryLength:5}},mounted:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o["a"])("JZ7exm3yUlWSewreBHs0celsfohscaod");case 3:setTimeout((function(){n.initMap(),n.checkLocationPermission()}),500),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),this.$message&&this.$message.error("热力图加载失败: "+t.t0.message);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));function n(){return t.apply(this,arguments)}return n}(),methods:{initMap:function(){if(window.BMap&&window.BMap.Map)try{this.map=new window.BMap.Map("heatmap-container",{enableMapClick:!1,displayOptions:{building:!1},enableScrollWheelZoom:!0,enableDoubleClickZoom:!0,enableKeyboard:!1});var t=new window.BMap.Point(l.DEFAULT_CENTER.lng,l.DEFAULT_CENTER.lat);this.map.centerAndZoom(t,l.DEFAULT_ZOOM),this.applyMapStyle(),this.setupMapEventListeners()}catch(n){}},applyMapStyle:function(){try{this.map.setMapStyleV2({styleJson:h})}catch(t){}},setupMapEventListeners:function(){var t=this;this.map.addEventListener("tilesloaded",(function(){t.mapLoaded=!0,t.initializeHeatmap()}))},initializeHeatmap:function(){var t=this;this.getCurrentLocationSilently((function(){var n=t.locationPoint||t.map.getCenter();t.fetchBusinessPOIs(n,l.SEARCH_RADIUS).then((function(){return t.renderHeatmap()})).catch((function(){return t.renderHeatmap()}))}))},handleBack:function(){try{if(window.Android){if(window.Android.onBackPressed)return void window.Android.onBackPressed();if(window.Android.goBack)return void window.Android.goBack();if(window.Android.back)return void window.Android.back()}}catch(t){}window.history.back()},locateToCurrent:function(){var t=this;navigator.geolocation?(this.checkLocationPermission(),navigator.geolocation.getCurrentPosition((function(n){return t.handleLocationSuccess(n)}),(function(){return t.handleLocationError()}))):this.handleLocationFallback()},handleLocationSuccess:function(t){var n=new window.BMap.Point(t.coords.longitude,t.coords.latitude);this.locationPoint=n,this.map&&this.map.panTo(n),this.showLocationTip=!1,this.updateCurrentMarker(n)},handleLocationError:function(){this.handleLocationFallback(),this.showLocationTip=!0},handleLocationFallback:function(){var t=new window.BMap.Point(l.DEFAULT_CENTER.lng,l.DEFAULT_CENTER.lat);this.locationPoint=t,this.map&&this.map.panTo(t),this.updateCurrentMarker(t)},getCurrentLocationSilently:function(t){var n=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){return n.handleSilentLocationSuccess(e,t)}),(function(){return n.handleSilentLocationError(t)})):this.handleSilentLocationFallback(t)},handleSilentLocationSuccess:function(t,n){var e=new window.BMap.Point(t.coords.longitude,t.coords.latitude);this.locationPoint=e,this.mapLoaded||this.map.centerAndZoom(e,l.LOCATION_ZOOM),this.updateCurrentMarker(e),n&&n()},handleSilentLocationError:function(t){this.handleSilentLocationFallback(t)},handleSilentLocationFallback:function(t){var n=new window.BMap.Point(l.DEFAULT_CENTER.lng,l.DEFAULT_CENTER.lat);this.locationPoint=n,this.mapLoaded||this.map.centerAndZoom(n,l.DEFAULT_ZOOM),this.updateCurrentMarker(n),t&&t()},checkLocationPermission:function(){var t=this;navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then((function(n){t.locationPermission=n.state,t.showLocationTip="denied"===n.state})).catch((function(){}))},enableLocation:function(){if("denied"===this.locationPermission){if(this.$message&&this.$message.info("请在浏览器/应用中开启定位权限"),window.Android&&window.Android.openLocationSettings)try{window.Android.openLocationSettings()}catch(t){}}else this.locateToCurrent()},renderHeatmap:function(){var t=this;if(this.map&&this.mapLoaded){this.clearHeatOverlays();var n=this.locationPoint||this.map.getCenter();if(n){var e=this.map.getZoom();if(this.heatPOIs&&this.heatPOIs.length)this.renderHeatFromPOIs(n,e);else{var i=this.generateBusinessCenters(n,e);i.forEach((function(n){return t.drawBusinessCluster(n,e)}))}}}},fetchBusinessPOIs:function(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.SEARCH_RADIUS,i=u.KEYWORDS.map((function(i){return n.searchNearbyPromise(i,t,e,u.WEIGHTS[i]||1)}));return Promise.allSettled(i).then((function(e){var i=new Map;e.forEach((function(t){"fulfilled"===t.status&&t.value.forEach((function(t){var n="".concat(t.name,"|").concat(t.lng.toFixed(4),"|").concat(t.lat.toFixed(4)),e=i.get(n);(!e||e.weight<t.weight)&&i.set(n,t)}))}));var a=t,r=Array.from(i.values()).sort((function(t,e){return n.distanceMeters(a,t)-n.distanceMeters(a,e)})).slice(0,l.MAX_POI_COUNT);n.heatPOIs=r}))},searchNearbyPromise:function(t,n,e){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new Promise((function(r){try{var o=new window.BMap.LocalSearch(i.map,{pageCapacity:50});o.setSearchCompleteCallback((function(n){try{var e=[];if(n&&n.getCurrentNumPois)for(var i=n.getCurrentNumPois(),o=0;o<i;o++){var s=n.getPoi(o);if(s&&s.point){var c=a*(s.numReviews?Math.min(1+s.numReviews/1e3,2):1);e.push({name:s.title||t,lng:s.point.lng,lat:s.point.lat,weight:c})}}r(e)}catch(l){r([])}})),o.searchNearby(t,n,e)}catch(s){r([])}}))},renderHeatFromPOIs:function(t,n){var e=this;if(this.mapLoaded){var i=this.getBaseRadiusByZoom(n),a=this.heatPOIs.slice(0,l.MAX_POI_COUNT);a.forEach((function(t){var n=Math.max(.6,Math.min(1.6,t.weight||1)),a=i*n,r=.45*a,o=.22+.08*(n-1),s=.28+.1*(n-1),c=new window.BMap.Point(t.lng,t.lat),l=e.createHeatCircle(c,a,u.COLORS.SECONDARY,o),h=e.createHeatCircle(c,r,u.COLORS.PRIMARY,s);e.map.addOverlay(l),e.map.addOverlay(h),e.heatOverlays.push(l,h)}))}},getBaseRadiusByZoom:function(t){return t>=18?120:t>=16?180:240},createHeatCircle:function(t,n,e,i){return new window.BMap.Circle(t,n,{strokeColor:"transparent",strokeWeight:0,fillColor:"rgba(".concat(e,", ").concat(i,")"),fillOpacity:i})},generateBusinessCenters:function(t,n){for(var e=this.getBusinessCenterCountByZoom(n),i=[],a=0;a<e;a++){var r=800+4200*Math.random(),o=Math.random()*Math.PI*2,s=this.metersToLng(r*Math.cos(o),t.lat),c=this.metersToLat(r*Math.sin(o));i.push(new window.BMap.Point(t.lng+s,t.lat+c))}return i},getBusinessCenterCountByZoom:function(t){return t>=18?4:t>=16?5:t>=14?6:7},drawBusinessCluster:function(t,n){var e=this;if(this.mapLoaded){var i=this.getCoreRadiusByZoom(n),a=[{r:i,color:u.COLORS.PRIMARY,opacity:.26},{r:.66*i,color:u.COLORS.SECONDARY,opacity:.28},{r:.4*i,color:u.COLORS.TERTIARY,opacity:.32}];a.forEach((function(n){var i=e.createHeatCircle(t,n.r,n.color,n.opacity);e.map.addOverlay(i),e.heatOverlays.push(i)})),this.addScatterPoints(t,n)}},addScatterPoints:function(t,n){for(var e=this.getScatterCountByZoom(n),i=0;i<e;i++){var a=Math.random()*Math.PI*2,r=80+760*Math.random(),o=new window.BMap.Point(t.lng+this.metersToLng(r*Math.cos(a),t.lat),t.lat+this.metersToLat(r*Math.sin(a))),s=40+120*Math.random(),c=.14+.22*Math.random(),l=this.createHeatCircle(o,s,u.COLORS.PRIMARY,c);this.map.addOverlay(l),this.heatOverlays.push(l)}},getScatterCountByZoom:function(t){return t>=18?20:t>=16?28:36},getCoreRadiusByZoom:function(t){return t>=18?140:t>=16?200:260},metersToLat:function(t){return t/111e3},metersToLng:function(t,n){return t/(111e3*Math.cos((n||0)*Math.PI/180))},clearHeatOverlays:function(){var t=this;try{this.heatOverlays.forEach((function(n){t.map&&n&&t.map.removeOverlay(n)}))}catch(n){}this.heatOverlays=[]},distanceMeters:function(t,n){try{var e=function(t){return t*Math.PI/180},i=6371e3,a=e(t.lat||t.getLat()),r=e(n.lat||n.getLat()),o=r-a,s=e((n.lng||n.getLng())-(t.lng||t.getLng())),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(o/2),2)+Math.cos(a)*Math.cos(r)*Math.pow(Math.sin(s/2),2)));return i*c}catch(l){return 0}},updateCurrentMarker:function(t){try{if(!this.map||!t)return;this.updateUserHeading(t);var n=new window.BMap.Size(32,38),e=new window.BMap.Icon(c.a,n,{imageSize:n,anchor:new window.BMap.Size(16,19),rotation:this.userHeading});this.currentMarker?(this.currentMarker.setPosition(t),this.currentMarker.setIcon(e)):(this.currentMarker=new window.BMap.Marker(t,{icon:e}),this.map.addOverlay(this.currentMarker))}catch(i){}},updateUserHeading:function(t){if(t)if(this.locationHistory.push({lng:t.lng,lat:t.lat,timestamp:Date.now()}),this.locationHistory.length>this.maxHistoryLength&&this.locationHistory.shift(),this.locationHistory.length<2)this.userHeading=0;else{var n=this.locationHistory[this.locationHistory.length-1],e=this.locationHistory[this.locationHistory.length-2],i=n.lng-e.lng,a=n.lat-e.lat;if(Math.abs(i)>1e-6||Math.abs(a)>1e-6){var r=180*Math.atan2(a,i)/Math.PI;r=90-r,r<0&&(r+=360),r>=360&&(r-=360),this.userHeading=r}}},getHeadingDescription:function(){for(var t=[{min:337.5,max:22.5,name:"北"},{min:22.5,max:67.5,name:"东北"},{min:67.5,max:112.5,name:"东"},{min:112.5,max:157.5,name:"东南"},{min:157.5,max:202.5,name:"南"},{min:202.5,max:247.5,name:"西南"},{min:247.5,max:292.5,name:"西"},{min:292.5,max:337.5,name:"西北"}],n=0,e=t;n<e.length;n++){var i=e[n];if(this.userHeading>=i.min&&this.userHeading<i.max)return i.name}return"北"}}},d=f,p=(e("6dcf"),e("2877")),v=Object(p["a"])(d,i,a,!1,null,"b2f2414e",null);n["default"]=v.exports},f1ae:function(t,n,e){"use strict";var i=e("86cc"),a=e("4630");t.exports=function(t,n,e){n in t?i.f(t,n,a(0,e)):t[n]=e}},f400:function(t,n,e){"use strict";var i=e("c26b"),a=e("b39a"),r="Map";t.exports=e("e0b8")(r,(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var n=i.getEntry(a(this,r),t);return n&&n.v},set:function(t,n){return i.def(a(this,r),0===t?0:t,n)}},i,!0)}}]);